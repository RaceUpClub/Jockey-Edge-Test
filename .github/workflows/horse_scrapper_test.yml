name: Horse Scraper - PDF Test

on:
  workflow_dispatch:
    inputs:
      test_date:
        description: 'Datum des PDFs (YYYY-MM-DD)'
        required: true
        default: '2026-02-01'

jobs:
  test-horse-parser:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install Dependencies
        run: pip install pdfplumber requests

      - name: Run Horse Parser (lokales PDF)
        run: |
          python wettstar_horse_scraper.py \
            --local ./20260201_DE_G_Dortmund_304472.pdf \
            --date ${{ github.event.inputs.test_date }} \
            --output ./horse_data/

      - name: CSV Preview
        run: |
          echo "=== Erste 3 Zeilen ==="
          head -3 ./horse_data/horse_starters_${{ github.event.inputs.test_date }}.csv || echo "CSV nicht gefunden"

      - name: Upload CSV als Artefakt
        uses: actions/upload-artifact@v4
        with:
          name: horse-starters-${{ github.event.inputs.test_date }}
          path: ./horse_data/*.csv
          retention-days: 7
